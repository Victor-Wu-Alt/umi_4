"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// @ts-ignore
const core_1 = require("@svgr/core");
const esbuild_1 = require("@umijs/bundler-utils/compiled/esbuild");
const fs_1 = __importDefault(require("fs"));
/**
 * an universal tool to transform SVG into React components
 * @param svgr svgr options
 * @param svgo svgo options
 * @param transformOptions include transform options to translate svg ReactComponent
 */
function svgrPlugin(svgr = {}, svgo = {}, transformOptions) {
    return {
        name: 'bundler-vite:svgr',
        async transform(code, id) {
            if (id.endsWith('.svg')) {
                let componentCode = code;
                if (svgr) {
                    const svgFile = fs_1.default.readFileSync(id, 'utf8');
                    const svgrCode = await (0, core_1.transform)(svgFile, {
                        icon: true,
                        svgoConfig: {
                            ...(svgo || {}),
                        },
                        ...svgr,
                        svgo: !!svgo,
                    }, { componentName: 'ReactComponent' });
                    componentCode =
                        svgrCode.replace('export default ReactComponent', 'export { ReactComponent }') +
                            '\n' +
                            code;
                }
                const result = await (0, esbuild_1.transform)(componentCode, {
                    loader: 'jsx',
                    sourcefile: id,
                    sourcemap: true,
                    ...transformOptions,
                });
                return {
                    code: result.code,
                    map: result.map || null,
                };
            }
        },
    };
}
exports.default = svgrPlugin;
