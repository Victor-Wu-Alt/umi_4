"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConfig = void 0;
const vite_1 = require("../../compiled/vite");
const plugins_1 = __importDefault(require("../plugins"));
const transformer_1 = __importDefault(require("./transformer"));
async function getConfig(opts) {
    const applyOpts = {
        ...opts.userConfig,
        entry: opts.entry,
        extraBabelPlugins: [
            ...(opts.extraBabelPlugins || []),
            ...(opts.userConfig.extraBabelPlugins || []),
        ],
        extraBabelPresets: [
            ...(opts.extraBabelPresets || []),
            ...(opts.userConfig.extraBabelPresets || []),
        ],
    };
    const vitePluginsConfig = (0, plugins_1.default)(applyOpts);
    const viteConfigFromUserConfig = (0, transformer_1.default)(applyOpts);
    let viteConfig = (0, vite_1.mergeConfig)(vitePluginsConfig, viteConfigFromUserConfig);
    if (opts.modifyViteConfig) {
        viteConfig = await opts.modifyViteConfig(viteConfig, {
            env: opts.env,
        });
    }
    return viteConfig;
}
exports.getConfig = getConfig;
