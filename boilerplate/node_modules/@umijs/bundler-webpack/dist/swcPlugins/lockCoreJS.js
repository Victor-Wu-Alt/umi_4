"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Visitor_1 = __importDefault(require("@swc/core/Visitor"));
const utils_1 = require("@umijs/utils");
const path_1 = require("path");
const changeImportFromString_1 = require("./changeImportFromString");
function addLastSlash(path) {
    return path.endsWith('/') ? path : `${path}/`;
}
class LockCoreJS extends Visitor_1.default {
    visitImportDeclaration(expression) {
        const { source } = expression;
        let { value, type } = source;
        if (type === 'StringLiteral' && value.startsWith('core-js/')) {
            const newValue = value.replace(/^core-js\//, addLastSlash((0, utils_1.winPath)((0, path_1.dirname)(require.resolve('core-js/package.json')))));
            (0, changeImportFromString_1.changeImportFromString)(expression, newValue);
        }
        return expression;
    }
}
exports.default = LockCoreJS;
