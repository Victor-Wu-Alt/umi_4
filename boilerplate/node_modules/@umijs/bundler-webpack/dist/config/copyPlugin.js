"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addCopyPlugin = void 0;
const fs_1 = require("fs");
const path_1 = require("path");
async function addCopyPlugin(opts) {
    const { config, userConfig, cwd } = opts;
    const copyPatterns = [
        (0, fs_1.existsSync)((0, path_1.join)(cwd, 'public')) && {
            from: (0, path_1.join)(cwd, 'public'),
        },
        ...(userConfig.copy
            ? userConfig.copy.map((item) => {
                if (typeof item === 'string') {
                    return {
                        from: (0, path_1.join)(cwd, item),
                        to: item,
                    };
                }
                return {
                    // 相对于 process.cwd，所以这里需要使用绝对路径
                    from: (0, path_1.join)(cwd, item.from),
                    to: item.to,
                };
            })
            : []),
    ].filter(Boolean);
    if (copyPatterns.length) {
        config
            .plugin('copy')
            .use(require('@umijs/bundler-webpack/compiled/copy-webpack-plugin'), [
            {
                patterns: copyPatterns,
            },
        ]);
    }
}
exports.addCopyPlugin = addCopyPlugin;
