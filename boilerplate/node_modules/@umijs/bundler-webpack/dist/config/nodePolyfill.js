"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addNodePolyfill = void 0;
const webpack_1 = require("@umijs/bundler-webpack/compiled/webpack");
async function addNodePolyfill(opts) {
    const { config } = opts;
    const nodeLibs = require('node-libs-browser');
    config.plugin('node-polyfill-provider').use(webpack_1.ProvidePlugin, [
        {
            Buffer: ['buffer', 'Buffer'],
            process: nodeLibs['process'],
        },
    ]);
    config.resolve.fallback.merge({
        ...Object.keys(nodeLibs).reduce((memo, key) => {
            if (nodeLibs[key]) {
                memo[key] = nodeLibs[key];
            }
            else {
                memo[key] = false;
            }
            return memo;
        }, {}),
        http: false,
        https: false,
    });
}
exports.addNodePolyfill = addNodePolyfill;
